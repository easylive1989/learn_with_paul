---
import type { NotionBlock } from '../../lib/notion';

interface Props { block: NotionBlock; }
const { block } = Astro.props;
const img = (block as any).image;
const rawUrl = img?.file?.url ?? img?.external?.url ?? '';
const isLocal = rawUrl.startsWith('/images/');
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const url = isLocal ? `${base}${rawUrl}` : rawUrl;
const caption = img.caption?.map((t: any) => t.plain_text).join('') ?? '';
---
<figure>
  <img src={url} alt={caption || 'Article image'} loading="lazy" />
  {caption && <figcaption>{caption}</figcaption>}
</figure>
